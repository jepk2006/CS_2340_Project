{% extends "base.html" %}
{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
  <aside class="lg:col-span-1 space-y-4">
    <form method="get" class="space-y-4">
      <div>
        <label class="block text-sm mb-1">Keywords</label>
        <input type="text" name="q" value="{{ query }}" placeholder="Search by name, headline, bio..." />
      </div>
      <div class="grid grid-cols-3 gap-2">
        <div>
          <label class="block text-sm mb-1">City</label>
          <input type="text" name="city" value="{{ city }}" />
        </div>
        <div>
          <label class="block text-sm mb-1">State</label>
          <input type="text" name="state" value="{{ state }}" />
        </div>
        <div>
          <label class="block text-sm mb-1">Country</label>
          <input type="text" name="country" value="{{ country }}" />
        </div>
      </div>
      <div>
        <label class="block text-sm mb-1">Skills</label>
        <input type="text" id="skillFilter" placeholder="Filter skills..." class="mb-2" />
        <div id="skillsList" class="max-h-56 overflow-auto border rounded p-2 flex flex-wrap gap-2">
          {% for skill in skills %}
            <label class="inline-flex items-center gap-1 text-sm px-2 py-1 rounded-full border cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700">
              <input type="checkbox" class="sr-only" name="skills" value="{{ skill.id }}" {% if skill.id in selected_skills %}checked{% endif %} />
              <span class="skill-chip">{{ skill.name }}</span>
            </label>
          {% endfor %}
        </div>
        {% block extra_scripts %}
        {{ block.super }}
        <script>
          (function(){
            const input = document.getElementById('skillFilter');
            const container = document.getElementById('skillsList');
            if(!input || !container) return;
            input.addEventListener('input', function(){
              const q = this.value.toLowerCase();
              Array.from(container.children).forEach(function(label){
                const name = label.querySelector('.skill-chip')?.textContent.toLowerCase() || '';
                label.style.display = name.includes(q) ? '' : 'none';
              });
            });
            // Toggle chip highlight when clicking the label
            container.addEventListener('click', function(e){
              const label = e.target.closest('label');
              if(!label) return;
              const checkbox = label.querySelector('input[type="checkbox"]');
              if(checkbox){
                checkbox.checked = !checkbox.checked;
                label.classList.toggle('bg-indigo-50', checkbox.checked);
                label.classList.toggle('border-indigo-300', checkbox.checked);
              }
            });
            // Initialize selected styles
            Array.from(container.querySelectorAll('label')).forEach(function(label){
              const cb = label.querySelector('input[type="checkbox"]');
              if(cb && cb.checked){
                label.classList.add('bg-indigo-50','border-indigo-300');
              }
            });
          })();
        </script>
        {% endblock %}
      </div>
      <button class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-500">Apply filters</button>
    </form>
  </aside>

  <section class="lg:col-span-3">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-xl font-semibold">Talent Search</h1>
      <span class="text-sm text-gray-500">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
      {% for profile in page_obj.object_list %}
        <div class="border border-gray-200 dark:border-gray-800 rounded-xl p-4 bg-white dark:bg-gray-800">
          <div class="flex items-center justify-between">
            <div class="font-medium">{{ profile.user.username }}</div>
            <div class="text-xs text-gray-500">{{ profile.location_city }}{% if profile.location_state %}, {{ profile.location_state }}{% endif %}{% if profile.location_country %}, {{ profile.location_country }}{% endif %}</div>
          </div>
          {% if profile.headline %}
            <div class="text-sm text-gray-600 dark:text-gray-300 mt-1">{{ profile.headline }}</div>
          {% endif %}
          {% if profile.bio %}
            <p class="text-sm text-gray-600 dark:text-gray-300 mt-2 line-clamp-3">{{ profile.bio }}</p>
          {% endif %}
          {% if profile.skills.all %}
            <div class="mt-3 flex flex-wrap gap-1">
              {% for s in profile.skills.all|slice:":6" %}
                <span class="text-xs px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700">{{ s.name }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% empty %}
        <div class="text-sm text-gray-500">No profiles match your filters.</div>
      {% endfor %}
    </div>

    <div class="flex items-center justify-between mt-6">
      {% if page_obj.has_previous %}
        <a class="px-3 py-1.5 border rounded" href="?{% if query %}q={{ query|urlencode }}&{% endif %}{% for sid in selected_skills %}skills={{ sid }}&{% endfor %}{% if city %}city={{ city|urlencode }}&{% endif %}{% if state %}state={{ state|urlencode }}&{% endif %}{% if country %}country={{ country|urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
      {% else %}
        <span></span>
      {% endif %}
      {% if page_obj.has_next %}
        <a class="px-3 py-1.5 border rounded" href="?{% if query %}q={{ query|urlencode }}&{% endif %}{% for sid in selected_skills %}skills={{ sid }}&{% endfor %}{% if city %}city={{ city|urlencode }}&{% endif %}{% if state %}state={{ state|urlencode }}&{% endif %}{% if country %}country={{ country|urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}


